      1    00FFFE              #include "msp430.h"                     ;
                                #define controlled include file
      2    00FFFE              
      3    00FFFE                      NAME    main                    ; module
                                name
      4    00FFFE              
      5    000000                      PUBLIC  main                    ; make
                                                                        the
                                                                        main
                                                                        label
                                                                        visible
      6    00FFFE                                                      ;
                                outside this module
      7    00FFFE                      ORG     0FFFEh
      8    00FFFE ....                 DC16    init                    ; set
                                                 reset vector to 'init'
                                                 label
      9    010000                      
     10    010000                      ; ustawienie wszystkich wektorow
                                przerwan oprocz
     11    010000                      ; Reset na domyslna obsluge
     12    00FFFC                      ORG     0FFFCh
     13    00FFFC ....                 DC16    default_int
     14    00FFFA                      ORG     0FFFAh
     15    00FFFA ....                 DC16    default_int
     16    00FFF6                      ORG     0FFF6h
     17    00FFF6 ....                 DC16    default_int
     18    00FFF4                      ORG     0FFF4h
     19    00FFF4 ....                 DC16    default_int
     20    00FFF2                      ORG     0FFF2h
     21    00FFF2 ....                 DC16    default_int
     22    00FFF0                      ORG     0FFF0h
     23    00FFF0 ....                 DC16    default_int
     24    00FFEE                      ORG     0FFEEh
     25    00FFEE ....                 DC16    default_int
     26    00FFEC                      ORG     0FFECh
     27    00FFEC ....                 DC16    default_int
     28    00FFE6                      ORG     0FFE6h
     29    00FFE6 ....                 DC16    default_int
     30    00FFE4                      ORG     0FFE4h
     31    00FFE4 ....                 DC16    default_int
     32    00FFE2                      ORG     0FFE2h
     33    00FFE2 ....                 DC16    default_int
     34    00FFE0                      ORG     0FFE0h
     35    00FFE0 ....                 DC16    default_int
     36    00FFE2                      
     37    00FFE8                      ORG     0FFE8h
     38    00FFE8 ....                 DC16    IO1_interrupt
     39    00FFEA                      
     40    00FFEA                      ORG     0FFEAh
     41    00FFEA ....                 DC16    timer_A_int
     42    00FFEC                      
     43    00FFF8                      ORG     0FFF8h
     44    00FFF8 ....                 DC16    timer_B_int
     45    00FFFA                      
     46    000000                      RSEG    CSTACK                  ;
  pre-declaration of segment
     47    000000                      RSEG    CODE                    ; place
  program in 'CODE' segment
     48    000000              
     49    000000 3140....     init:   MOV     #SFE(CSTACK), SP        ; set up
                                                            stack
     50    000004              
     51    000004 0343         main:   NOP                             ; main
                                                                        program
     52    000006 B240805A2001         MOV.W   #WDTPW+WDTHOLD,&WDTCTL  ; Stop
                                                                        watchdo
                                                                       g
                                                                        timer
     53    00000C                        
     54    00000C                      
     55    00000C                      ; b0 - g0 - przycisk ladowania
     56    00000C                      ; b1 - g1 - przycisk zliczania w
                                dol
     57    00000C F0D00300....         BIS.B #003h, P1IES              ; ustaw
                                                                        edge
                                                                        select
                                                                        na H->L
                                                                        dla b0,
                                                                        b1
     58    000012 F0D00300....         BIS.B #003h, P1IE               ; wlacz
                                                                        przerwa
                                                                       nie dla
                                                                        b0,
                                                                        b1
     59    000018                      
     60    000018 F0D08000....         BIS.B #080h, P1DIR              ; ustaw
                                                                        b7 jako
                                                                        bit
                                                                        wyjscio
                                                                       wy
     61    00001E                                                      ; (dioda
                                bledu)
     62    00001E F0D08000....         BIS.B #080h, P1OUT              ; gasi
                                                                        diode
                                                                        bledu
     63    000024                      
     64    000024 F0D3....             BIS.B #0FFh, P6DIR              ; ustaw
                                                                        P6 jako
                                                                        port
                                                                        wyjscio
                                                                       wy
     65    000028                      
     66    000028                      ; przygotuj licznik timer A
     67    000028                      ; licznik A ma liczyc w trybie UP od 0
                                do wartosci TACCR0
     68    000028                      ; przerwanie TACCR0 wykorzystywane jest
                                przez obsluge
     69    000028                      ; eliminacji drgan
     70    000028 B0D00201....         BIS #0102h, TACTL               ; wlacz
                                                                        przerwa
                                                                       nia dla
                                                                        Timer
                                                                        A
     71    00002E                                                      ; ustaw
                                zegar timera na ACLK
     72    00002E B0400500....         MOV #0005h, TACCR0              ; ustaw
                                                                        5 jako
                                                                        wartosc
                                                                        do
                                                                        ktorej
                                                                        
     73    000034                                                      ; liczy
                                timer
     74    000034                      
     75    000034 B0405802....         MOV #258h ,TBCCR1                   ;
  wartosc do liczenia przy odswiezaniu
     76    00003A                                                      ; 2ms ->
                                600 -> 258 
     77    00003A B0403075....         MOV #7530h ,TBCCR2              ;wartosc
                                                                        do
                                                                        liczeni
                                                                       a przy
                                                                        pomiarz
                                                                       e
                                                                        czasu
     78    000040                                                      ; 1
                                sekunda-> 30000 -> 7530h
     79    000040 B0D02201....         BIS #0122h,TBCTL                ; wlacz
                                                                        przerwa
                                                                       nia
     80    000046                                                      ; ustaw
                                zegar timera na ACLK
     81    000046                                                      ;
                                wystartuj liczenie
     82    000046 0A43                 MOV #0000h,R10                  ;
                                                                        zerowan
                                                                       ie
                                                                        sekund
                                                                        i
                                                                        minut
     83    000048 0943                 MOV #0000h,R9                   ;
                                                                        zerowan
                                                                       ie
                                                                        godzin
     84    00004A 3040....             BR #init_interrupts             ;
                                                                        przesko
                                                                       cz
                                                                        procedu
                                                                       ry
                                                                        obslugi
                                                                        przerwa
                                                                       n
     85    00004E                      
     86    00004E                      ; procedury obslugi przerwan
     87    00004E              IO1_interrupt:
     88    00004E D0B3....             BIT.B #001h, P1IFG              ; g0
                                                                        ?
     89    000052 0124                 JZ IO1_checkg1
     90    000054 1FD3                 BIS #0001h, R15                 ; ustaw
                                                                        znaczni
                                                                       k
                                                                        g0
     91    000056              IO1_checkg1:
     92    000056 E0B3....             BIT.B #002h, P1IFG              ; g1
                                                                        ?
     93    00005A 0124                 JZ IO1_clear
     94    00005C 2FD3                 BIS #0002h, R15                 ; ustaw
                                                                        znaczni
                                                                       k
                                                                        g1
     95    00005E              IO1_clear:
     96    00005E F0C3....             BIC.B #0FFh, P1IFG              ; czysc
                                                                        znaczni
                                                                       ki
                                                                        przerwa
                                                                       n
     97    000062 0612                 PUSH R6
     98    000064 16410200             MOV 2(SP), R6
     99    000068 36C01000             BIC #CPUOFF, R6                 ;
                                                                        zmodyfi
                                                                       kuj
                                                                        lezace
                                                                        na
                                                                        stosie
                                                                        SR
    100    00006C 81460200             MOV R6, 2(SP)                   ; aby
                                                obudzic procesor
    101    000070 3641                 POP R6
    102    000072 0013                 RETI
    103    000074                      
    104    000074              timer_A_int:
    105    000074 2FD2                 BIS #0004h, R15                 ; ustaw
                                                                        znaczni
                                                                       k
                                                                        timer_A
                                                                       _TACCR0
    106    000076 90C3....             BIC #0001h, TACTL
    107    00007A 0612                 PUSH R6
    108    00007C 16410200             MOV 2(SP), R6
    109    000080 36C01000             BIC #CPUOFF, R6                 ;
                                                                        zmodyfi
                                                                       kuj
                                                                        lezace
                                                                        na
                                                                        stosie
                                                                        SR
    110    000084 81460200             MOV R6, 2(SP)                   ; aby
                                                obudzic procesor
    111    000088 3641                 POP R6
    112    00008A 0013                 RETI
    113    00008C              
    114    00008C              timer_B_int:
    115    00008C              
    116    00008C 10521E01             ADD &TBIV,PC                  ; Add
                                                  offset to Jump table
    117    000090 0013                 RETI                   ; Vector 0: No
                                                               interrupt
                                                               
    118    000092 0A3C                 JMP CCIFG_1_HND               ; Vector
                                                                      2: Module
                                                                      1
                                                                      
    119    000094 053C                 JMP CCIFG_2_HND               ; Vector
                                                                      4: Module
                                                                      2
                                                                      
    120    000096 0013                 RETI                          ; Vector
                                                                      6: Module
                                                                      3
    121    000098 0013                 RETI                          ; Vector
                                                                      8: Module
                                                                      4
    122    00009A 0013                 RETI                          ; Vector
                                                                      10:
                                                                      Module
                                                                      5
    123    00009C 0013                 RETI                          ; Vector
                                                                      12:
                                                                      Module
                                                                      6
    124    00009E                      
    125    00009E              TBIFG_HND:                           ; Vector
                                14: TIMOV Flag
    126    00009E                                                    ; Task
                                starts here
    127    00009E 0013                 RETI 
    128    0000A0              CCIFG_2_HND:                        ; Vector 4:
                                Module 2
    129    0000A0                                                  ; odswiezani
                               e 
    130    0000A0                                                  
    131    0000A0                      ;TODO odswiezanie
    132    0000A0 B0505802....         ADD #258h,TBCCR2            ; ustawienie
                                                                    nowego
                                                                    punktu do
                                                                    liczenia
    133    0000A6 F23F                 JMP timer_B_int              ; sprawdza
                                                                     czy nie ma
                                                                     innego
                                                                     przerwania
                                                                     do
                                                                     obsluzenia
    134    0000A8              
    135    0000A8              CCIFG_1_HND:                        ; Vector 2:
                                Module 1
    136    0000A8 0712                 PUSH R7                            ;
  liczenie czasu
    137    0000AA 1953                 INC R9
    138    0000AC 09A3                 DADC R9
    139    0000AE 3740FF00             MOV #0ffh,R7
    140    0000B2 07F9                 AND R9,R7
    141    0000B4 37906000             CMP #0060h,R7               ;sprawdza
                                                                    czy juz
                                                                    minelo
                                                                    60s
    142    0000B8 0520                 JNE Minuty
    143    0000BA 39C0FF00             BIC #000ffh,R9
    144    0000BE 39500001             ADD #0100h,R9
    145    0000C2 09A3                 DADC R9
    146    0000C4              Minuty:
    147    0000C4 374000FF             MOV #0FF00h,R7
    148    0000C8 07F9                 AND R9,R7
    149    0000CA 37900060             CMP #6000h, R7            ; sprawdza czy
                                                                  juz minelo 60
                                                                  minut
    150    0000CE 0D20                 JNE RETURN
    151    0000D0 39C000FF             BIC #0ff00h,R9
    152    0000D4 1853                 INC R8
    153    0000D6 08A3                 DADC R8
    154    0000D8 38902400             CMP #024h,R8
    155    0000DC 0620                 JNE RETURN
    156    0000DE 0843                 MOV #00h,R8                 ;przekrec
                                                                    licznik od
                                                                    poczatku
    157    0000E0 B0503075....         ADD #7530h,TBCCR1            ;
                                                                     ustawienie
                                                                     nowego
                                                                     punktu do
                                                                     liczenia
    158    0000E6 3741                 POP R7
    159    0000E8 D13F                 JMP timer_B_int              ; sprawdza
                                                                     czy nie ma
                                                                     innego
                                                                     przerwania
                                                                     do
                                                                     obsluzenia
    160    0000EA 3741         RETURN: POP R7
    161    0000EC 0013                 RETI
    162    0000EE              default_int:
    163    0000EE F0C08000....         BIC.B #080h, P1OUT              ; zapala
                                                                        diode
                                                                        bledu
    164    0000F4 0013                 RETI
    165    0000F6                      
    166    0000F6              init_interrupts:
    167    0000F6                      ; ustawienie wszystkich wektorow
                                przerwan oprocz
    168    0000F6                      ; Reset na domyslna obsluge
    169    0000F6              
    170    0000F6                      
    171    0000F6 0443                 CLR R4
    172    0000F8 0C43                 CLR R12
    173    0000FA 0D43                 CLR R13
    174    0000FC 0E43                 CLR R14
    175    0000FE 0F43                 CLR R15
    176    000100 C044....             MOV.B R4, P6OUT                 ;
                                                  wyswietl licznik poprzez P6
                                                  
    177    000104                      
    178    000104              app:    
    179    000104                      ; R4  - licznik BCD na mniej znaczacym
                                bajcie
    180    000104                      ; R12 - zliczanie cykli eliminacji
                                drgan, max 32 (20h)
    181    000104                      ; R13 - zliczanie wartosci poszukiwanej
                                w eliminacji drgan
    182    000104                      ;       (ile razy pod rzad sie
                                pojawila), max 4
    183    000104                      ; R14 - stan ukladu (na najmniej
                                znaczacych 3ech bitach)
    184    000104                      ;       bit3 == 1 => jestesmy w obsludze
                                g1
    185    000104                      ; R15 - znaczniki uzywane przez
                                przerwania i aplikacje
    186    000104                      ;       b2: nastapilo przerwanie timera
                                A
    187    000104                      ;       b1: wcisnieto g1
    188    000104                      ;       b0: wcisnieto g0
    189    000104                      ; R9 - zegar 8 bit na godzine 1-23
    190    000104                      ; R8 - zegar 8 bit na sekundy + 8bit na
                                minuty
    191    000104 32C2                 DINT
    192    000106              
    193    000106                      ; zlikwiduj kombinacje g0 & g1
    194    000106 1FB3                 BIT #0001h, R15                 ; g0
                                                                        ?
    195    000108 0C24                 JZ check000
    196    00010A                      
    197    00010A 2FB3                 BIT #0002h, R15                 ; g0 &
                                                                        g1
                                                                        ?
    198    00010C 0A24                 JZ check000
    199    00010E                      
    200    00010E                      ; wyjdz z obslugi g1
    201    00010E 2FC3                 BIC #0002h, R15                 ; czysc
                                                                        g1, g0
                                                                        jest
                                                                        wazniej
                                                                       sze
    202    000110 2EB2                 BIT #0004h, R14                 ; czy
                                                                        jestesm
                                                                       y w
                                                                        obsludz
                                                                       e
                                                                        g1?
    203    000112 0724                 JZ check000
    204    000114                      
    205    000114 0D43                 CLR R13                         ; czysc
                                                                        licznik
                                                                       i
                                                                        elimina
                                                                       cji
                                                                        drgan
    206    000116 0C43                 CLR R12
    207    000118 E0C3....             BIC.B #002h, P1IE               ;
                                                                        zabloku
                                                                       j
                                                                        przerwa
                                                                       nia
                                                                        g1
    208    00011C 1E43                 MOV #0001h, R14                 ;
                                                                        przejdz
                                                                        do
                                                                        stanu
                                                                        001
    209    00011E 3040....             BR #do001
    210    000122                      
    211    000122                      ;------------- automat stanowy
                                -----------------
    212    000122                      ; sprawdz w jakim stanie znajduje sie
                                uklad
    213    000122              check000:
    214    000122 0E93                 CMP #0000h, R14                 ; stan
                                                                        000
    215    000124 1620                 JNE check001
    216    000126 1FB3                 BIT #0001h, R15                 ; g0
                                                                        ?
    217    000128 0924                 JZ ch000_g1
    218    00012A F0C00300....         BIC.B #003h, P1IE               ; wylacz
                                                                        przerwa
                                                                       nia g0,
                                                                        g1
    219    000130 1E43                 MOV #0001h, R14                 ; stan
                                                                        := 001
                                                                        
    220    000132 B0D01000....         BIS #0010h, TACTL               ; Timer
                                                                        A start
                                                                        UP to
                                                                        TACCR0
    221    000138 3040....             BR #sleep
    222    00013C              ch000_g1:
    223    00013C 2FB3                 BIT #0002h, R15                 ; g1
                                                                        ?
    224    00013E C624                 JZ sleep
    225    000140 E0C3....             BIC.B #002h, P1IE               ; wylacz
                                                                        przerwa
                                                                       nie
                                                                        g1
    226    000144 3E400500             MOV #0005h, R14                 ; stan
                                                                        :=
                                                                        101
    227    000148 B0D01000....         BIS #0010h, TACTL               ; Timer
                                                                        A start
                                                                        UP to
                                                                        TACCR0
    228    00014E 3040....             BR #sleep
    229    000152                      
    230    000152                      ;--------------- obsluga g0 ------------
                               -------
    231    000152              check001:
    232    000152 1E93                 CMP #0001h, R14                 ; stan
                                                                        001
    233    000154 2720                 JNE check011
    234    000156 2FB2         do001:  BIT #0004h, R15                 ;
                                                                        przerwa
                                                                       nie
                                                                        timer_A
    235    000158 B924                 JZ sleep
    236    00015A 2FC2                 BIC #0004h, R15
    237    00015C 1D53                 INC R13                         ;
                                                                        licznik
                                                                       _zer++
    238    00015E 1C53                 INC R12                         ;
                                                                        licznik
                                                                       _cykli++
    239    000160 D0B3....             BIT.B #001h, P1IN               ; g0 !=
                                                                        0
                                                                        ?
    240    000164 0124                 JZ noclr001
    241    000166 0D43                 CLR R13                        
                                                                        
    242    000168              noclr001:
    243    000168 2D92                 CMP #0004h, R13                
                                                                        
    244    00016A 0C20                 JNE timeout001
    245    00016C                      ; eliminacja drgan zakonczona
    246    00016C 5440....             MOV.B P3IN, R4                  ; laduj
                                                    licznik z P3
    247    000170              
    248    000170 12C3                 CLRC                            ;
                                                                        korekcj
                                                                       a
                                                                        wczytan
                                                                       ej
                                                                        wartosc
                                                                       i do
                                                                        BCD
    249    000172 04A3                 DADC R4
    250    000174                             
    251    000174 C044....             MOV.B R4, P6OUT                 ;
                                                  wyswietl licznik poprzez
                                                  P6
    252    000178 3E400300             MOV #0003h, R14                 ; stan
                                                                        :=
                                                                        011
    253    00017C 0D43                 CLR R13                         ; czysc
                                                                        licznik
                                                                       i
                                                                        elimina
                                                                       cji
                                                                        drgan
    254    00017E 0C43                 CLR R12
    255    000180 3040....             BR #sleep
    256    000184              timeout001:
    257    000184 3C902000             CMP #0020h, R12
    258    000188 A120                 JNE sleep
    259    00018A 0E43                 MOV #0000h, R14                 ; stan
                                                                        :=
                                                                        000
    260    00018C 0D43                 CLR R13                         ; czysc
                                                                        licznik
                                                                       i
                                                                        elimina
                                                                       cji
                                                                        drgan
    261    00018E 0C43                 CLR R12
    262    000190 3FC00300             BIC #0003h, R15                 ; czysc
                                                                        informa
                                                                       cje o
                                                                        obsludz
                                                                       e g0,
                                                                        g1
    263    000194 F0D00300....         BIS.B #003h, P1IE               ; wlacz
                                                                        przerwa
                                                                       nia g0,
                                                                        g1
    264    00019A B0C01000....         BIC #0010h, TACTL               ; Timer
                                                                        A stop
                                                                        UP to
                                                                        TACCR0
    265    0001A0 3040....             BR #sleep
    266    0001A4                      
    267    0001A4              check011:
    268    0001A4 3E900300             CMP #0003h, R14                 ; stan
                                                                        011
    269    0001A8 0820                 JNE check010
    270    0001AA 2FB2                 BIT #0004h, R15                 ;
                                                                        przerwa
                                                                       nie
                                                                        timer_A
    271    0001AC 8F24                 JZ sleep
    272    0001AE D0B3....             BIT.B #001h, P1IN               ; g0 !=
                                                                        0
                                                                        ?
    273    0001B2 8C24                 JZ sleep
    274    0001B4 2E43                 MOV #0002h, R14                 ; stan
                                                                        :=
                                                                        010
    275    0001B6 3040....             BR #sleep
    276    0001BA                      
    277    0001BA              check010: 
    278    0001BA 2E93                 CMP #0002h, R14                 ; stan
                                                                        010
    279    0001BC 2420                 JNE check101
    280    0001BE 2FB2                 BIT #0004h, R15                 ;
                                                                        przerwa
                                                                       nie
                                                                        timer_A
    281    0001C0 8524                 JZ sleep
    282    0001C2 2FC2                 BIC #0004h, R15
    283    0001C4 1D53                 INC R13                         ;
                                                                        licznik
                                                                       _zer++
    284    0001C6 1C53                 INC R12                         ;
                                                                        licznik
                                                                       _cykli++
    285    0001C8 D0B3....             BIT.B #001h, P1IN               ; g0 !=
                                                                        0
                                                                        ?
    286    0001CC 0120                 JNZ noclr010
    287    0001CE 0D43                 CLR R13        
    288    0001D0              noclr010:
    289    0001D0 2D92                 CMP #0004h, R13                
                                                                        
    290    0001D2 1020                 JNE timeout010
    291    0001D4                      ; eliminacja drgan zakonczona
    292    0001D4 B0C01000....         BIC #0010h, TACTL               ; Timer
                                                                        A stop
                                                                        UP to
                                                                        TACCR0
    293    0001DA 0E43                 MOV #0000h, R14                 ; stan
                                                                        :=
                                                                        000
    294    0001DC 0D43                 CLR R13                         ; czysc
                                                                        licznik
                                                                       i
                                                                        elimina
                                                                       cji
                                                                        drgan
    295    0001DE 0C43                 CLR R12
    296    0001E0 3FC00300             BIC #0003h, R15                 ; czysc
                                                                        informa
                                                                       cje o
                                                                        obsludz
                                                                       e g0,
                                                                        g1
    297    0001E4 F0C00300....         BIC.B #003h, P1IFG              ; czysc
                                                                        informa
                                                                       cje o
                                                                        przerwa
                                                                       niach
                                                                        g0,
                                                                        g1
    298    0001EA F0D00300....         BIS.B #003h, P1IE               ; wlacz
                                                                        przerwa
                                                                       nia g0,
                                                                        g1
    299    0001F0 3040....             BR #sleep
    300    0001F4              timeout010:
    301    0001F4 3C902000             CMP #0020h, R12
    302    0001F8 6920                 JNE sleep
    303    0001FA 3E400300             MOV #0003h, R14                 ; stan
                                                                        :=
                                                                        011
    304    0001FE 0D43                 CLR R13                         ; czysc
                                                                        licznik
                                                                       i
                                                                        elimina
                                                                       cji
                                                                        drgan
    305    000200 0C43                 CLR R12
    306    000202 3040....             BR #sleep
    307    000206                      
    308    000206                      ;--------------- obsluga g1 ------------
                               -------
    309    000206              check101:        
    310    000206 3E900500             CMP #0005h, R14                 ; stan
                                                                        101
    311    00020A 3320                 JNE check111
    312    00020C 2FB2                 BIT #0004h, R15                 ;
                                                                        przerwa
                                                                       nie
                                                                        timer_A
    313    00020E 5E24                 JZ sleep
    314    000210 2FC2                 BIC #0004h, R15
    315    000212 1D53                 INC R13                         ;
                                                                        licznik
                                                                       _zer++
    316    000214 1C53                 INC R12                         ;
                                                                        licznik
                                                                       _cykli++
    317    000216 E0B3....             BIT.B #002h, P1IN               ; g1 !=
                                                                        0
                                                                        ?
    318    00021A 0124                 JZ noclr101
    319    00021C 0D43                 CLR R13        
    320    00021E              noclr101:
    321    00021E 2D92                 CMP #0004h, R13                
                                                                        
    322    000220 1920                 JNE timeout101
    323    000222                      
    324    000222 1483                 DEC R4                          ;
                                                                        zmniejs
                                                                       z
                                                                        licznik
                                                                        o
                                                                        1
    325    000224 0644                 MOV R4,R6 
    326    000226 36F00F00             AND #000Fh, R6 
    327    00022A 36900F00             CMP  #000Fh, R6 
    328    00022E 0220                 JNE checkhigh101
    329    000230 74C00600             BIC.B #006h, R4                 ; popraw
                                                                        dolny
                                                                        bajt do
                                                                        BCD
                                                                        jesli
                                                                        trzeba
    330    000234              checkhigh101:
    331    000234 0644                 MOV R4, R6
    332    000236 36F0F000             AND #00F0h, R6
    333    00023A 3690F000             CMP #00F0h, R6
    334    00023E 0220                 JNE checkend101
    335    000240 34C06000             BIC #0060h, R4                  ; popraw
                                                                        gorny
                                                                        bajt do
                                                                        BCD
                                                                        jesli
                                                                        trzeba
    336    000244              checkend101:
    337    000244 C044....             MOV.B R4, P6OUT                 ;
                                                  wyswietl licznik poprzez
                                                  P6
    338    000248              
    339    000248 3E400700             MOV #0007h, R14                 ; stan
                                                                        :=
                                                                        111
    340    00024C 0D43                 CLR R13                         ; czysc
                                                                        licznik
                                                                       i
                                                                        elimina
                                                                       cji
                                                                        drgan
    341    00024E 0C43                 CLR R12
    342    000250 3040....             BR #sleep
    343    000254              timeout101:
    344    000254 3C902000             CMP #0020h, R12
    345    000258 3920                 JNE sleep
    346    00025A 0E43                 MOV #0000h, R14                 ; stan
                                                                        :=
                                                                        000
    347    00025C 0D43                 CLR R13                         ; czysc
                                                                        licznik
                                                                       i
                                                                        elimina
                                                                       cji
                                                                        drgan
    348    00025E 0C43                 CLR R12
    349    000260 2FC3                 BIC #0002h, R15                 ; czysc
                                                                        informa
                                                                       cje o
                                                                        obsludz
                                                                       e
                                                                        g1
    350    000262 F0D00300....         BIS.B #003h, P1IE               ; wlacz
                                                                        przerwa
                                                                       nia g0,
                                                                        g1
    351    000268 B0C01000....         BIC #0010h, TACTL               ; Timer
                                                                        A stop
                                                                        UP to
                                                                        TACCR0
    352    00026E 3040....             BR #sleep
    353    000272              
    354    000272              check111:
    355    000272 3E900700             CMP #0007h, R14                 ; stan
                                                                        111
    356    000276 0920                 JNE check110
    357    000278 2FB2                 BIT #0004h, R15                 ;
                                                                        przerwa
                                                                       nie
                                                                        timer_A
    358    00027A 2824                 JZ sleep
    359    00027C E0B3....             BIT.B #002h, P1IN               ; g1 !=
                                                                        0
                                                                        ?
    360    000280 2524                 JZ sleep
    361    000282 3E400600             MOV #0006h, R14                 ; stan
                                                                        :=
                                                                        110
    362    000286 3040....             BR #sleep
    363    00028A              
    364    00028A              check110: 
    365    00028A                      ;CMP #0006h, R14                ; stan
                                110, nie musimy sprawdzac
    366    00028A 2FB2                 BIT #0004h, R15                 ;
                                                                        przerwa
                                                                       nie
                                                                        timer_A
    367    00028C 1F24                 JZ sleep
    368    00028E 2FC2                 BIC #0004h, R15
    369    000290 1D53                 INC R13                         ;
                                                                        licznik
                                                                       _zer++
    370    000292 1C53                 INC R12                         ;
                                                                        licznik
                                                                       _cykli++
    371    000294 E0B3....             BIT.B #002h, P1IN               ; g1 !=
                                                                        0
                                                                        ?
    372    000298 0120                 JNZ noclr110
    373    00029A 0D43                 CLR R13        
    374    00029C              noclr110:
    375    00029C 2D92                 CMP #0004h, R13                
                                                                        
    376    00029E 0D20                 JNE timeout110
    377    0002A0                      ; eliminacja drgan zakonczona
    378    0002A0 B0C01000....         BIC #0010h, TACTL               ; Timer
                                                                        A stop
                                                                        UP to
                                                                        TACCR0
    379    0002A6 0E43                 MOV #0000h, R14                 ; stan
                                                                        :=
                                                                        000
    380    0002A8 0D43                 CLR R13                         ; czysc
                                                                        licznik
                                                                       i
                                                                        elimina
                                                                       cji
                                                                        drgan
    381    0002AA 0C43                 CLR R12
    382    0002AC 2FC3                 BIC #0002h, R15                 ; czysc
                                                                        informa
                                                                       cje o
                                                                        obsludz
                                                                       e
                                                                        g1
    383    0002AE E0C3....             BIC.B #002h, P1IFG              ; czysc
                                                                        informa
                                                                       cje o
                                                                        przerwa
                                                                       niu
                                                                        g1
    384    0002B2 E0D3....             BIS.B #002h, P1IE               ; wlacz
                                                                        przerwa
                                                                       nie
                                                                        g1
    385    0002B6 3040....             BR #sleep
    386    0002BA              timeout110:
    387    0002BA 3C902000             CMP #0020h, R12
    388    0002BE 0620                 JNE sleep
    389    0002C0 3E400700             MOV #0007h, R14                 ; stan
                                                                        :=
                                                                        111
    390    0002C4 0D43                 CLR R13                         ; czysc
                                                                        licznik
                                                                       i
                                                                        elimina
                                                                       cji
                                                                        drgan
    391    0002C6 0C43                 CLR R12
    392    0002C8 3040....             BR #sleep
    393    0002CC                     
    394    0002CC              sleep:
    395    0002CC 32D01800             BIS #GIE+CPUOFF, SR             ;
                                                                        przejsc
                                                                       ie do
                                                                        LPM1
    396    0002D0 3040....             BR #app                         ; skok
                                                                        na
                                                                        poczate
                                                                       k czesci
                                                                        aplikac
                                                                       yjnej
    397    0002D4              
    398    0002D4                      END
##############################
#          CRC:42C           #
#        Errors:   0         #
#        Warnings: 0         #
#         Bytes: 756         #
##############################



