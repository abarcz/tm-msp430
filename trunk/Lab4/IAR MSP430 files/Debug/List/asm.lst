      1    00FFFE              #include "msp430.h"             ; #define
                                controlled include file
      2    00FFFE              
      3    00FFFE                      NAME    main            ; module
                                name
      4    00FFFE              
      5    000000                      PUBLIC  main            ; make the main
                                                                label
                                                                visible
      6    00FFFE                                              ; outside this
                                module
      7    00FFFE                      ORG     0FFFEh
      8    00FFFE ....                 DC16    init            ; set reset
                                                                vector to
                                                                'init'
                                                                label
      9    010000                      
     10    010000                      ; ustawienie wszystkich wektorow
                                przerwan oprocz
     11    010000                      ; Reset na domyslna obsluge
     12    00FFFC                      ORG     0FFFCh
     13    00FFFC ....                 DC16    default_int
     14    00FFFA                      ORG     0FFFAh
     15    00FFFA ....                 DC16    default_int
     16    00FFF6                      ORG     0FFF6h
     17    00FFF6 ....                 DC16    default_int
     18    00FFF4                      ORG     0FFF4h
     19    00FFF4 ....                 DC16    default_int
     20    00FFF2                      ORG     0FFF2h
     21    00FFF2 ....                 DC16    default_int
     22    00FFF0                      ORG     0FFF0h
     23    00FFF0 ....                 DC16    default_int
     24    00FFEE                      ORG     0FFEEh
     25    00FFEE ....                 DC16    default_int
     26    00FFEA                      ORG     0FFEAh
     27    00FFEA ....                 DC16    default_int
     28    00FFE6                      ORG     0FFE6h
     29    00FFE6 ....                 DC16    default_int
     30    00FFE4                      ORG     0FFE4h
     31    00FFE4 ....                 DC16    default_int
     32    00FFE2                      ORG     0FFE2h
     33    00FFE2 ....                 DC16    default_int
     34    00FFE0                      ORG     0FFE0h
     35    00FFE0 ....                 DC16    default_int
     36    00FFE2                      
     37    00FFE8                      ORG     0FFE8h
     38    00FFE8 ....                 DC16    IO1_interrupt
     39    00FFEA                      
     40    00FFEC                      ORG     0FFECh
     41    00FFEC ....                 DC16    timer_A_int
     42    00FFEE                      
     43    00FFF8                      ORG     0FFF8h
     44    00FFF8 ....                 DC16    timer_B_int
     45    00FFFA                      
     46    000000                      RSEG    CSTACK        ; pre-declaration
  of segment
     47    000000                      RSEG    CODE          ; place program in
  'CODE' segment
     48    000000              
     49    000000 3140....     init:   MOV     #SFE(CSTACK), SP        ; set up
                                                            stack
     50    000004              
     51    000004 0343         main:   NOP                   ; main program
     52    000006 B240805A2001         MOV.W   #WDTPW+WDTHOLD,&WDTCTL  ; Stop
                                                                        watchdo
                                                                       g
                                                                        timer
     53    00000C                        
     54    00000C                      
     55    00000C                      ; b0 - g0 - przycisk ladowania
     56    00000C                      ; b1 - g1 - przycisk zliczania w
                                dol
     57    00000C F0D00300....         BIS.B #003h, P1IES    ; ustaw edge
                                                              select na H->L
                                                              dla b0,
                                                              b1
     58    000012 F0D00300....         BIS.B #003h, P1IE     ; wlacz przerwanie
                                                              dla b0,
                                                              b1
     59    000018                      
     60    000018 F0D08000....         BIS.B #080h, P1DIR    ; ustaw b7 jako
                                                              bit wyjsciowy
     61    00001E                                            ; (dioda
                                bledu)
     62    00001E F0D08000....         BIS.B #080h, P1OUT    ; gasi diode
                                                              bledu
     63    000024                      
     64    000024 F0D3....             BIS.B #0FFh, P6DIR    ; ustaw P6 jako
                                                              port wyjsciowy
     65    000028                      
     66    000028                      ; przygotuj licznik timer A
     67    000028                      ; licznik A ma liczyc w trybie UP od 0
                                do wartosci TACCR0
     68    000028                      ; przerwanie TACCR0 wykorzystywane jest
                                przez obsluge
     69    000028                      ; eliminacji drgan
     70    000028 B0D00001....         BIS #0100h, TACTL     ; ustaw zegar
                                                              timera na
                                                              ACLK
     71    00002E B0400500....         MOV #0005h, TACCR0    ; ustaw 5 jako
                                                              wartosc do ktorej
                                                              
     72    000034                                            ; liczy timer
     73    000034 B0D01000....         BIS #0010h, TACCTL0   ; wlacz przerwania
                                                              CCIFG0
     74    00003A                      
     75    00003A                      ; przygotuj licznik timer B w trybie
                                continous
     76    00003A B0405802....         MOV #258h ,TBCCR1     ; wartosc do
                                                              liczenia przy
                                                              odswiezaniu
     77    000040                                            ; 2ms -> 600 ->
                                258 
     78    000040 B0403075....         MOV #7530h ,TBCCR2    ; wartosc do
                                                              liczenia przy
                                                              pomiarze
                                                              czasu
     79    000046                                            ; 1 sekunda->
                                30000 -> 7530h
     80    000046 0943                 CLR R9                ; zerowanie sekund
                                                              i minut
     81    000048 0843                 CLR R8                ; zerowanie
                                                              godzin
     82    00004A              
     83    00004A 3040....             BR #init_registers    ; przeskocz
                                                              procedury obslugi
                                                              przerwan
     84    00004E                      
     85    00004E                      ; procedury obslugi przerwan
     86    00004E              IO1_interrupt:
     87    00004E D0B3....             BIT.B #001h, P1IFG    ; g0 ?
     88    000052 0124                 JZ IO1_checkg1
     89    000054 1FD3                 BIS #0001h, R15       ; ustaw znacznik
                                                              g0
     90    000056              IO1_checkg1:
     91    000056 E0B3....             BIT.B #002h, P1IFG    ; g1 ?
     92    00005A 0124                 JZ IO1_clear
     93    00005C 2FD3                 BIS #0002h, R15       ; ustaw znacznik
                                                              g1
     94    00005E              IO1_clear:
     95    00005E F0C3....             BIC.B #0FFh, P1IFG    ; czysc znaczniki
                                                              przerwan
     96    000062 0612                 PUSH R6
     97    000064 16410200             MOV 2(SP), R6
     98    000068 36C01000             BIC #CPUOFF, R6       ; zmodyfikuj
                                                              lezace na stosie
                                                              SR
     99    00006C 81460200             MOV R6, 2(SP)         ; aby obudzic
                                                              procesor
    100    000070 3641                 POP R6
    101    000072 0013                 RETI
    102    000074                      
    103    000074              timer_A_int:
    104    000074 2FD2                 BIS #0004h, R15       ; ustaw znacznik
                                                              timer_A_TACCR0
    105    000076                      ;BIC #0001h, TACTL
    106    000076 0612                 PUSH R6
    107    000078 16410200             MOV 2(SP), R6
    108    00007C 36C01000             BIC #CPUOFF, R6       ; zmodyfikuj
                                                              lezace na stosie
                                                              SR
    109    000080 81460200             MOV R6, 2(SP)         ; aby obudzic
                                                              procesor
    110    000084 3641                 POP R6
    111    000086 0013                 RETI
    112    000088              
    113    000088              timer_B_int:
    114    000088              
    115    000088 10521E01             ADD &TBIV,PC          ; Add offset to
                                                              Jump table
    116    00008C 0013                 RETI                  ; Vector 0: No
                                                              interrupt
                                                              
    117    00008E 0A3C                 JMP CCIFG_1_HND       ; Vector 2: Module
                                                              1 
    118    000090 053C                 JMP CCIFG_2_HND       ; Vector 4: Module
                                                              2 
    119    000092 0013                 RETI                  ; Vector 6: Module
                                                              3
    120    000094 0013                 RETI                  ; Vector 8: Module
                                                              4
    121    000096 0013                 RETI                  ; Vector 10:
                                                              Module 5
    122    000098 0013                 RETI                  ; Vector 12:
                                                              Module 6
    123    00009A                      
    124    00009A              TBIFG_HND:                    ; Vector 14: TIMOV
                                Flag
    125    00009A                                            ; Task starts
                                here
    126    00009A 0013                 RETI 
    127    00009C              CCIFG_2_HND:                  ; Vector 4: Module
                                2
    128    00009C                                            ; odswiezanie
                                
    129    00009C                                                  
    130    00009C                      ;TODO odswiezanie
    131    00009C B0505802....         ADD #258h,TBCCR2      ; ustawienie
                                                              nowego punktu do
                                                              liczenia
    132    0000A2 F23F                 JMP timer_B_int       ; sprawdza czy nie
                                                              ma innego
                                                              przerwania do
                                                              obsluzenia
    133    0000A4              
    134    0000A4              CCIFG_1_HND:                  ; Vector 2: Module
                                1
    135    0000A4 0712                 PUSH R7               ; liczenie
                                                              czasu
    136    0000A6 1953                 INC R9
    137    0000A8 09A3                 DADC R9
    138    0000AA 3740FF00             MOV #0ffh,R7
    139    0000AE 07F9                 AND R9,R7
    140    0000B0 37906000             CMP #0060h,R7         ;sprawdza czy juz
                                                              minelo 60s
    141    0000B4 0520                 JNE Minuty
    142    0000B6 39C0FF00             BIC #000ffh,R9
    143    0000BA 39500001             ADD #0100h,R9
    144    0000BE 09A3                 DADC R9
    145    0000C0              Minuty:
    146    0000C0 374000FF             MOV #0FF00h,R7
    147    0000C4 07F9                 AND R9,R7
    148    0000C6 37900060             CMP #6000h, R7        ; sprawdza czy juz
                                                              minelo 60
                                                              minut
    149    0000CA 0D20                 JNE RETURN
    150    0000CC 39C000FF             BIC #0ff00h,R9
    151    0000D0 1853                 INC R8
    152    0000D2 08A3                 DADC R8
    153    0000D4 38902400             CMP #024h,R8
    154    0000D8 0620                 JNE RETURN
    155    0000DA 0843                 MOV #00h,R8           ;przekrec licznik
                                                              od poczatku
    156    0000DC B0503075....         ADD #7530h,TBCCR1     ; ustawienie
                                                              nowego punktu do
                                                              liczenia
    157    0000E2 3741                 POP R7
    158    0000E4 D13F                 JMP timer_B_int       ; sprawdza czy nie
                                                              ma innego
                                                              przerwania do
                                                              obsluzenia
    159    0000E6 3741         RETURN: POP R7
    160    0000E8 0013                 RETI
    161    0000EA              default_int:
    162    0000EA F0C08000....         BIC.B #080h, P1OUT    ; zapala diode
                                                              bledu
    163    0000F0 0013                 RETI
    164    0000F2                      
    165    0000F2              init_registers:
    166    0000F2              
    167    0000F2 0543                 CLR R5
    168    0000F4 0643                 CLR R6
    169    0000F6 0A43                 CLR R10
    170    0000F8 0B43                 CLR R11
    171    0000FA 0C43                 CLR R12
    172    0000FC 0D43                 CLR R13
    173    0000FE 0F43                 CLR R15
    174    000100 B0D01000....         BIS #0010h, TBCCTL1   ; wlacz przerwania
                                                              
    175    000106 B0D01000....         BIS #0010h, TBCCTL2   ; wlacz przerwania
                                                              
    176    00010C B0D02201....         BIS #0122h,TBCTL      ; wlacz przerwania
    177    000112                                            ; ustaw zegar
                                timera na ACLK
    178    000112                                            ; wystartuj
                                liczenie
    179    000112                                            
    180    000112                                            
    181    000112              app:        
    182    000112                      ; R4  - rejestr obliczen tymczasowych
    183    000112                      ; R5  - stan ukladu w kontekscie obslugi
                                g0
    184    000112                      ;       (na najmniej znaczacych 2och
                                bitach)
    185    000112                      ; R6  - stan ukladu w kontekscie obslugi
                                g1
    186    000112                      ;       (na najmniej znaczacych 2och
                                bitach)
    187    000112                      ; R8  - zegar 8 bit na godzine
                                1-23
    188    000112                      ; R9  - zegar 8 bit na sekundy + 8bit na
                                minuty
    189    000112                      ; R10 - g0::zliczanie cykli eliminacji
                                drgan, max 32 (20h)
    190    000112                      ; R11 - g0::zliczanie wartosci
                                poszukiwanej w eliminacji drgan
    191    000112                      ;       (ile razy pod rzad sie
                                pojawila), max 4
    192    000112                      ; R12 - g1::zliczanie cykli eliminacji
                                drgan, j.w.
    193    000112                      ; R13 - g1::zliczanie wartosci
                                poszukiwanej w eliminacji drgan
    194    000112                      ;       j.w.
    195    000112                      ; R14 - rejestr obliczen tymczasowych
                                
    196    000112                      ;     
    197    000112                      ; R15 - znaczniki uzywane przez
                                przerwania i aplikacje
    198    000112                      ;       b3: 1 => wyswietlanie mm:ss
    199    000112                      ;           0 => wyswietlanie hh:mm
    200    000112                      ;       b2: nastapilo przerwanie timera
                                A
    201    000112                      ;       b1: wcisnieto g1
    202    000112                      ;       b0: wcisnieto g0
    203    000112                      
    204    000112                      
    205    000112                      ;----------- automat stanowy g0
                                -----------
    206    000112                      ; sprawdz w jakim stanie znajduje sie
                                uklad
    207    000112              check000:
    208    000112 0593                 CMP #0000h, R5      ; stan 000
    209    000114 0A20                 JNE check001
    210    000116 1FB3                 BIT #0001h, R15     ; g0 ?
    211    000118 5224                 JZ autom_g1
    212    00011A D0C3....             BIC.B #001h, P1IE   ; wylacz przerwanie
                                                            g0
    213    00011E 1543                 MOV #0001h, R5      ; stan := 001
                                                            
    214    000120 B0D01000....         BIS #0010h, TACTL   ; Timer A start UP
                                                            to TACCR0
    215    000126 3040....             BR #autom_g1        ; przejdz do obslugi
                                                            g1
    216    00012A                      
    217    00012A                      ;--------------- obsluga g0 ------------
                               ---
    218    00012A              check001:
    219    00012A 1593                 CMP #0001h, R5      ; stan 001
    220    00012C 1F20                 JNE check011
    221    00012E 2FB2         do001:  BIT #0004h, R15     ; przerwanie
                                                            timer_A
    222    000130 4624                 JZ autom_g1
    223    000132 1B53                 INC R11             ; licznik_zer++
    224    000134 1A53                 INC R10             ; licznik_cykli++
    225    000136 D0B3....             BIT.B #001h, P1IN   ; g0 != 0 ?
    226    00013A 0124                 JZ noclr001
    227    00013C 0B43                 CLR R11                        
                                                                        
    228    00013E              noclr001:
    229    00013E 2B92                 CMP #0004h, R11                
                                                                        
    230    000140 0A20                 JNE timeout001
    231    000142                      ; eliminacja drgan zakonczona
    232    000142 3FB2                 BIT #0008h, R15
    233    000144 3FD2                 BIS #0008h, R15     ; ustaw mm:ss
    234    000146 0124                 JZ mmssset001
    235    000148 3FC2                 BIC #0008h, R15     ; ustaw hh:mm
    236    00014A              mmssset001:
    237    00014A 35400300             MOV #0003h, R5      ; stan := 011
    238    00014E 0B43                 CLR R11             ; czysc liczniki
                                                            eliminacji
                                                            drgan
    239    000150 0A43                 CLR R10
    240    000152 3040....             BR #autom_g1
    241    000156              timeout001:
    242    000156 3A902000             CMP #0020h, R10
    243    00015A 3120                 JNE autom_g1
    244    00015C 0543                 MOV #0000h, R5      ; stan := 000
    245    00015E 0B43                 CLR R11             ; czysc liczniki
                                                            eliminacji
                                                            drgan
    246    000160 0A43                 CLR R10
    247    000162 1FC3                 BIC #0001h, R15     ; czysc informacje o
                                                            obsludze g0
    248    000164 D0D3....             BIS.B #001h, P1IE   ; wlacz przerwanie
                                                            g0
    249    000168 3040....             BR #autom_g1
    250    00016C                      
    251    00016C              check011:
    252    00016C 35900300             CMP #0003h, R5      ; stan 011
    253    000170 0820                 JNE check010
    254    000172 2FB2                 BIT #0004h, R15     ; przerwanie
                                                            timer_A
    255    000174 2424                 JZ autom_g1
    256    000176 D0B3....             BIT.B #001h, P1IN   ; g0 != 0 ?
    257    00017A 2124                 JZ autom_g1
    258    00017C 2543                 MOV #0002h, R5      ; stan := 010
    259    00017E 3040....             BR #autom_g1
    260    000182                      
    261    000182              check010: 
    262    000182                      ;CMP #0002h, R5     ; stan 010, nie
                                musimy sprawdzac
    263    000182 2A20                 JNE check101
    264    000184 2FB2                 BIT #0004h, R15     ; przerwanie
                                                            timer_A
    265    000186 1B24                 JZ autom_g1
    266    000188 1B53                 INC R11             ; licznik_zer++
    267    00018A 1A53                 INC R10             ; licznik_cykli++
    268    00018C D0B3....             BIT.B #001h, P1IN   ; g0 != 0 ?
    269    000190 0120                 JNZ noclr010
    270    000192 0B43                 CLR R11        
    271    000194              noclr010:
    272    000194 2B92                 CMP #0004h, R11                
                                                                        
    273    000196 0A20                 JNE timeout010
    274    000198                      ; eliminacja drgan zakonczona
    275    000198 0543                 MOV #0000h, R5      ; stan := 000
    276    00019A 0B43                 CLR R11             ; czysc liczniki
                                                            eliminacji
                                                            drgan
    277    00019C 0A43                 CLR R10
    278    00019E 1FC3                 BIC #0001h, R15     ; czysc informacje o
                                                            obsludze g0
    279    0001A0 D0C3....             BIC.B #001h, P1IFG  ; czysc informacje o
                                                            przerwaniach
                                                            g0
    280    0001A4 D0D3....             BIS.B #001h, P1IE   ; wlacz przerwania
                                                            g0
    281    0001A8 3040....             BR #autom_g1
    282    0001AC              timeout010:
    283    0001AC 3A902000             CMP #0020h, R10
    284    0001B0 0620                 JNE autom_g1
    285    0001B2 35400300             MOV #0003h, R5      ; stan := 011
    286    0001B6 0B43                 CLR R11             ; czysc liczniki
                                                            eliminacji
                                                            drgan
    287    0001B8 0A43                 CLR R10
    288    0001BA 3040....             BR #autom_g1
    289    0001BE                      
    290    0001BE              autom_g1:
    291    0001BE                      ;----------- automat stanowy g1
                                -----------
    292    0001BE 0693                 CMP #0000h, R6      ; stan 100 (dla
                                                            porzadku 000h)
    293    0001C0 0B20                 JNE check101
    294    0001C2 2FB3                 BIT #0002h, R15     ; g1 ?
    295    0001C4 FC27                 JZ autom_g1
    296    0001C6 E0C3....             BIC.B #002h, P1IE   ; wylacz przerwanie
                                                            g1
    297    0001CA 36400500             MOV #0005h, R6      ; stan := 101
    298    0001CE B0D01000....         BIS #0010h, TACTL   ; Timer A start UP
                                                            to TACCR0
    299    0001D4 3040....             BR #sleep
    300    0001D8                      
    301    0001D8                      ;--------------- obsluga g1 ------------
                               ---
    302    0001D8              check101:        
    303    0001D8 36900500             CMP #0005h, R6      ; stan 101
    304    0001DC 4120                 JNE check111
    305    0001DE 2FB2                 BIT #0004h, R15     ; przerwanie
                                                            timer_A
    306    0001E0 6824                 JZ sleep
    307    0001E2 1D53                 INC R13             ; licznik_zer++
    308    0001E4 1C53                 INC R12             ; licznik_cykli++
    309    0001E6 E0B3....             BIT.B #002h, P1IN   ; g1 != 0 ?
    310    0001EA 0124                 JZ noclr101
    311    0001EC 0D43                 CLR R13        
    312    0001EE              noclr101:
    313    0001EE 2D92                 CMP #0004h, R13                
                                                                        
    314    0001F0 2A20                 JNE timeout101
    315    0001F2                      
    316    0001F2 0443                 CLR R4
    317    0001F4 5440....             MOV.B P4IN, R4      ; laduj mm do
                                                            R4
    318    0001F8 34903C00             CMP #60, R4
    319    0001FC 0238                 JL nommchange101
    320    0001FE 34403B00             MOV #59, R4
    321    000202              nommchange101:
    322    000202 0454                 RLA R4
    323    000204 0454                 RLA R4
    324    000206 0454                 RLA R4
    325    000208 0454                 RLA R4              ; R4 == [mm00]
    326    00020A                      
    327    00020A 0E43                 CLR R14
    328    00020C 5E40....             MOV.B P3IN, R14     ; laduj hh do
                                                            R14
    329    000210 3E901800             CMP #24, R14
    330    000214 0238                 JL nohhchange101
    331    000216 3E401700             MOV #23, R14        ; R14 = [00hh]
    332    00021A              nohhchange101:
    333    00021A              
    334    00021A B0C01100....         BIC #0011h, TBCCTL2 ; wylacz przerwania
                                                            zliczania
                                                            zegara
    335    000220 B0C03000....         BIC #0030h, TBCTL   ; zastopuj
                                                            timerB
    336    000226 8043....             CLR TBR             ; czysc timerB
    337    00022A 084E                 MOV R14, R8         ; ustaw hh
    338    00022C 0944                 MOV R4, R9          ; ustaw mmss
    339    00022E B0D02000....         BIS #0020h, TBCTL   ; wlacz timerB
    340    000234 B0D01000....         BIS #0010h, TBCCTL2 ; wlacz przerwania
                                                            zliczania
                                                            zegara
    341    00023A              
    342    00023A 36400700             MOV #0007h, R6      ; stan := 111
    343    00023E 0D43                 CLR R13             ; czysc liczniki
                                                            eliminacji
                                                            drgan
    344    000240 0C43                 CLR R12
    345    000242 3040....             BR #sleep
    346    000246              timeout101:
    347    000246 3C902000             CMP #0020h, R12
    348    00024A 3320                 JNE sleep
    349    00024C 0643                 MOV #0000h, R6      ; stan := 100
    350    00024E 0D43                 CLR R13             ; czysc liczniki
                                                            eliminacji
                                                            drgan
    351    000250 0C43                 CLR R12
    352    000252 2FC3                 BIC #0002h, R15     ; czysc informacje o
                                                            obsludze g1
    353    000254 E0C3....             BIC.B #002h, P1IFG  ; czysc informacje o
                                                            przerwaniu
                                                            g1
    354    000258 E0D3....             BIS.B #002h, P1IE   ; wlacz przerwania
                                                            g1
    355    00025C 3040....             BR #sleep
    356    000260              
    357    000260              check111:
    358    000260 36900700             CMP #0007h, R6      ; stan 111
    359    000264 0920                 JNE check110
    360    000266 2FB2                 BIT #0004h, R15     ; przerwanie
                                                            timer_A
    361    000268 2424                 JZ sleep
    362    00026A E0B3....             BIT.B #002h, P1IN   ; g1 != 0 ?
    363    00026E 2124                 JZ sleep
    364    000270 36400600             MOV #0006h, R6      ; stan := 110
    365    000274 3040....             BR #sleep
    366    000278              
    367    000278              check110: 
    368    000278                      ;CMP #0006h, R6     ; stan 110, nie
                                musimy sprawdzac
    369    000278 2FB2                 BIT #0004h, R15     ; przerwanie
                                                            timer_A
    370    00027A 1B24                 JZ sleep
    371    00027C 1D53                 INC R13             ; licznik_zer++
    372    00027E 1C53                 INC R12             ; licznik_cykli++
    373    000280 E0B3....             BIT.B #002h, P1IN   ; g1 != 0 ?
    374    000284 0120                 JNZ noclr110
    375    000286 0D43                 CLR R13        
    376    000288              noclr110:
    377    000288 2D92                 CMP #0004h, R13                
                                                                        
    378    00028A 0A20                 JNE timeout110
    379    00028C                      ; eliminacja drgan zakonczona
    380    00028C 0643                 MOV #0000h, R6      ; stan := 000
    381    00028E 0D43                 CLR R13             ; czysc liczniki
                                                            eliminacji
                                                            drgan
    382    000290 0C43                 CLR R12
    383    000292 2FC3                 BIC #0002h, R15     ; czysc informacje o
                                                            obsludze g1
    384    000294 E0C3....             BIC.B #002h, P1IFG  ; czysc informacje o
                                                            przerwaniu
                                                            g1
    385    000298 E0D3....             BIS.B #002h, P1IE   ; wlacz przerwanie
                                                            g1
    386    00029C 3040....             BR #sleep
    387    0002A0              timeout110:
    388    0002A0 3C902000             CMP #0020h, R12
    389    0002A4 0620                 JNE sleep
    390    0002A6 36400700             MOV #0007h, R6      ; stan := 111
    391    0002AA 0D43                 CLR R13             ; czysc liczniki
                                                            eliminacji
                                                            drgan
    392    0002AC 0C43                 CLR R12
    393    0002AE 3040....             BR #sleep
    394    0002B2                     
    395    0002B2              sleep:
    396    0002B2 2FC2                 BIC #0004h, R15     ; wyczyszczenie info
                                                            o przerwaniu
    397    0002B4                                          ;  timerA jesli
                                bylo
    398    0002B4 3FB00300             BIT #0003h, R15     ; czy trwa obsluga
                                                            g0 lub g1?
    399    0002B8 0320                 JNZ enter_lpm       ; jesli tak, to
                                                            spij
    400    0002BA B0C01000....         BIC #0010h, TACTL   ; Timer A stop UP to
                                                            TACCR0
    401    0002C0               
    402    0002C0              enter_lpm:        
    403    0002C0 32D01800             BIS #GIE+CPUOFF, SR ; przejscie do
                                                            LPM1
    404    0002C4 3040....             BR #app             ; skok na poczatek
                                                            czesci aplikacyjnej
    405    0002C8              
    406    0002C8                      END
##############################
#          CRC:BFB8          #
#        Errors:   0         #
#        Warnings: 0         #
#         Bytes: 744         #
##############################



